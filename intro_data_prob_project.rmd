---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
```

### Load data

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data


* * *

## Part 2: Research questions

**Research quesion 1:**

### Do people in coastal states have better health than those in landlocked states?

According to Wikipedia, there are 25 states and territories of the USA that have a coastal line, and the rest 28 including the District of Columbia are 'landlocked'. So, the states are almost equally divided which makes it interesting to compare. My personal belief is that proximity to the ocean makes people happier but happiness is something hard to evaluate, so I'll be focusing on people's health instead.

**Research quesion 2:**

### Do smokers drink soda and alcohol more often than non-smokers?

**Research quesion 3:**

### Does a smoker have a higher chance to live alone?

That would be fun to know if there's an association between living alone and smoking. If there's an association, would that mean that smoking leads you to live alone or vice versa? Not really. Association doesn't mean causation. For the sake of this test I suspect that being a smoker (explanatory variable) might affect your tendency of being the only person in your household or living with somebody (response variable).    

* * *

## Part 3: Exploratory data analysis

NOTE: Insert code chunks as needed by clicking on the "Insert a new code chunk" 
button (green button with orange arrow) above. Make sure that your code is visible
in the project you submit. Delete this note when before you submit your work.

**Research quesion 1:**

#### Do people in coastal states have better health than those in landlocked states?

*Step 1*   
We want to take a closer look at the X_state variable first to see if there are any input errors.

```{r}
unique(brfss2013$X_state)
```

There are rows with '0' and '80' values among other states. We can check them manually to find that those values are in two cases only. We can filter them out but 2 cases out of half a million won't make any impact on the results.

```{r}
brfss2013 %>%
  filter(X_state != "0", X_state != "80") %>%
  group_by(X_state) %>%
  summarise(count = n())
```

*Step 2*  
We need to create a list (vector in R terms) of coastal states first. In the data frame brfss2013 we create a new binary variable 'coastal_state'. Then, we compare the variable X_state with the vector to determine whether the state is coastal and set coastal_state to TRUE if it is, or FALSE if it isn't. 

```{r}
coastal_states_vector <- c("Alabama","Alaska","California","Connecticut","Delaware","Florida","Georgia","Guam","Hawaii","Louisiana","Maine","Maryland","Massachusetts","Mississippi","New Hampshire","New Jersey","New York","North Carolina","Oregon","Puerto Rico","Rhode Island","South Carolina","Texas","Virginia","Washington")

# which(cs_lines <- brfss2013$X_state %in% coastal_states_vector)

brfss2013 <- brfss2013 %>%
  mutate(coastal_state = ifelse(X_state %in% coastal_states_vector, TRUE, FALSE)) 
```

*Step 3*  
Select people with good health. This data frame has two variables indicating self-reported health condition: 'General Health' (genhlth) with 5 levels from poor to excellent, and a calculated binary variable 'Adults with good or better health' (_rfhlth) grouping people in two distinct groups (Fair or Poor health, and Good or Better health). We're interested in the latter variable as it fits our needs perfectly.

```{r}
brfss2013 %>%
  group_by(coastal_state, X_rfhlth) %>%
  summarise((count = n()))

# This bar plot shows the frequency distribution of 'Adults with good or better health' variable.
ggplot(brfss2013, mapping = aes(x = X_rfhlth)) +
  geom_bar(stat = "count")

# Now, we create a subset of data consisting of only the coastal states and territories. All NA's and no responses are excluded.
coastal <- filter(brfss2013, coastal_state == TRUE, !is.na(X_rfhlth)) 
  coastal_total <- nrow(coastal) 
  coastal_goodhealth <- nrow(filter(coastal, X_rfhlth == "Good or Better Health"))
  coastal_gh_proportion <- coastal_goodhealth/coastal_total

# Bar plot of the frequency distribution for coastal states only    
coastal %>%
  ggplot(aes(x = X_rfhlth)) +
  geom_bar(stat = "count")

## Proportion of people with good or better health in coastal states and territories
show(coastal_gh_proportion)
  
# Similarly, we create a subset of landlocked states.
landlocked <- filter(brfss2013, coastal_state == FALSE, !is.na(X_rfhlth))
  landlocked_total <- nrow(landlocked) 
  landlocked_goodhealth <- nrow(filter(landlocked, X_rfhlth == "Good or Better Health"))
  landlocked_gh_proportion <- landlocked_goodhealth/landlocked_total

# Bar plot of the frequency distribution for landlocked states only
landlocked %>%
  ggplot(aes(x = X_rfhlth)) +
  geom_bar(stat = "count")  
  
## Proportion of people with good or better health in landlocked states  
show(landlocked_gh_proportion)


```

We can see that the proportion of people with good or better health in landlocked states is higher: 81.6% in landlocked states and 79.7% in coastal ones. This means that the average person in a coastal state has no better health than one in a landlocked state.

However, health care in the US territories like Puerto Rico and Guam may differ from one in main states, so we can exclude them from the analysis to see if the proportion changes. 

```{r}
coastal_no_territories <- filter(coastal, X_state != "Guam", X_state != "Puerto Rico")  
  cnt_total <- nrow(coastal_no_territories)
  cnt_goodhealth <- nrow(filter(coastal_no_territories, X_rfhlth == "Good or Better Health"))
  cnt_gh_proportion <- cnt_goodhealth/cnt_total
  
## Proportion of people with good or better health in states without Guam and Puerto Rico
  show(cnt_gh_proportion)
```

In fact, the proportion of people with good or better health in coastal states excluding Guam and Puerto Rico slightly increased and got even closer to one in landlocked states (80.2% and 81.6% respectively).

*Step 4*  
We can also check if an average person in a coastal state has higher chance of reporting an Excellent health.

```{r}
coastal_excellenthlth <- nrow(filter(coastal, genhlth == "Excellent"))
coastal_eh_proportion <- coastal_excellenthlth/coastal_total

landlocked_excellenthlth <- nrow(filter(landlocked, genhlth == "Excellent"))
landlocked_eh_proportion <- landlocked_excellenthlth/landlocked_total

cnt_excellenthlth <- nrow(filter(coastal_no_territories, genhlth == "Excellent"))
cnt_eh_proportion <- cnt_excellenthlth/cnt_total
```
  
Proportions of people reporting Excellent health in coastal, landlocked, and coastal excluding territories states:
```{r echo=FALSE}
show(coastal_eh_proportion)
show(landlocked_eh_proportion) 
show(cnt_eh_proportion)
```


Our analysis shows that the average person in a coastal state has no better health than one in a landlocked state. So the answer to the first question is **NO**.  


**Research quesion 2:**

```{r}

```



**Research quesion 3:**

#### Does a smoker have a higher chance to live alone?

*Step 1*  
We need to define variables of interest first. The variable 'numadult' represents the number of adults in the household. This is a discrete variable with numerical values. Another variable of interest is 'smokday2' which shows the frequency of days currently smoking. 

Numadult takes the values between 1 and 45 in this data frame with lots of NAs that we would need to exclude from the analysis. We are interested in the cases with 1 adult in the household.

Also, we should only consider the households with one adult and no children in them - the categorical variable 'X_chldcnt', Computed Number Of Children In Household, is handy here. 
```{r}
brfss2013 %>%
  filter(X_chldcnt == "No children in household", !is.na(numadult)) %>%
  group_by(numadult) %>%
  summarise(n())
```

This var takes values from Every Day to Some days to Not at all. For this test, we would consider person a smoker if s/he smokes every day or some days. There's a calculated value in this data frame that counts all smokers and non-smokers for us, X_rfsmok3. We'll be using this variable in future analysis.
```{r}
brfss2013 %>%
  group_by(smokday2) %>%
  summarise(n())

brfss2013 %>%
  filter(!is.na(smokday2), !is.na(numadult), X_chldcnt == "No children in household") %>%
  ggplot(aes(x = smokday2, y = numadult)) +
  geom_count()
```
  
*The count plot above shows the size of a household and smoker status with the number of cases*  


*Step 2*  
Here's the summary showing the relationship between the smokers (X_rfsmok3) and number of adults in the household (numadult).

```{r}
brfss2013 %>%
  filter(!is.na(X_rfsmok3), !is.na(numadult), X_chldcnt == "No children in household") %>%
  group_by(X_rfsmok3, numadult) %>%
  summarise(n())
```
We're only interested in households with 1 adult with no children. Those households with more than one adult should be combined into one group. We then need to create additional variable 'home_alone' consisting of 2 values: TRUE and FALSE.

```{r}
brfss2013 <- brfss2013 %>%
  filter(!is.na(numadult), !is.na(X_chldcnt)) %>%
  mutate(home_alone = ifelse(numadult == 1, ifelse(X_chldcnt == "No children in household", TRUE, FALSE), FALSE)) 
```

The following code calculate the values needed for the contingency table.

```{r}
# Create a contingency table with two categorical vars:
smokers_tab1 <- with(brfss2013,
  table(X_rfsmok3, home_alone))

# Show table
smokers_tab1

# Show percents
prop.table(smokers_tab1)*100

# Total for smokers/non-smokers
rowSums(smokers_tab1)

# Total for alone/not-alone
colSums(smokers_tab1)

```


*Step 3*  
We can now find if proportion of **smokers living alone** exceeds the proportions of **non-smokers living alone**.

```{r}
prop.table(smokers_tab1, margin = 1)*100
```

Indeed, we can see that 34.35% of smokers live alone against 32.12% of non-smokers living alone. 

Taking the other way around, we can check if a random person being **the only member of his or her household** has a higher chance of **being a smoker**, than has a person living with somebody. Since we already have all of the values from a contingency table, it's quite easy to calculate:

```{r}
prop.table(smokers_tab1, margin = 2)*100
```

Again, we can see a higher chance of living alone and being a smoker, than living with somebody and being a smoker: 14.86% and 13.63% respectively.

*Conclusion*
We found out that an average smoker has 2.23% higher chance of living alone, than non-smoker. Also, an average person livig alone has 1.23% higher chance of being a smoker than one living with somebody. This makes sense but doesn't mean that these two factors are really connected. There might be a confounding variable affecting both of them instead. Anyway, **the answer to the question 3 is YES**.
